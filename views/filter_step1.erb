<%
  # map params key-values to session key-values
  params_to_session

  # map some params who are specific for for the filter
  redirect_on_success = session['redirect_on_success']
  redirect_on_error = session['redirect_on_error']

  # setup default values
  redirect_on_error = "/leads/step1" if redirect_on_error.to_s.size == 0
  redirect_on_success = "/leads/step2" if redirect_on_success.to_s.size == 0



  begin
    selected_jobs = params.values.to_s
    @login.user.preference('settings.users.job_positions', '', selected_jobs)
  rescue => e
    # libero recursos
    DB.disconnect
    GC.start
    # redirect
    redirect "#{redirect_on_error}?err="+ CGI::escape(e.message)
  end

  # blanquo la variable de sesion de redirect
  session['redirect_on_success'] = nil

  # redirect
  redirect redirect_on_success
%>