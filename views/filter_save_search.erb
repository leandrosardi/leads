<%

  # map some params who are specific for for the filter
  redirect_on_error = session['redirect_on_error']
  # setup default values
  redirect_on_error = "/leads/results" if redirect_on_error.to_s.size == 0
  redirect_on_success = "/leads/results" if redirect_on_success.to_s.size == 0


  begin
    puts params
    name = params["search-name"]
    description = params["search-description"]
    total_rows = params["total-rows"]
    s = nil
    DB.transaction do
      # crear el cliente
      s = Leads::FlSearch.new({saved: true, id_user: @login.user.id, name: name, description: description,
                               no_of_results: total_rows})
      s.save
      puts s.inspect
    end # transaction
  rescue => e
    # libero recursos
    DB.disconnect
    GC.start
    # return errors
    redirect "#{redirect_on_error}?err="+ CGI::escape(e.message)

  end

  redirect "#{redirect_on_success}?msg=Search+Saved+Successfully"
%>