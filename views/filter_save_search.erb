<%

  # map some params who are specific for for the filter
  redirect_on_error = session['redirect_on_error']
  # setup default values
  redirect_on_error = "/leads/results" if redirect_on_error.to_s.size == 0
  redirect_on_success = "/leads/results" if redirect_on_success.to_s.size == 0


  begin
    puts params.inspect
    name = params["search-name"]
    description = params["search-description"]
    total_rows = params["total-rows"]
    position = params["position"]
    industry = params["industry"]
    location = params["location"]

    s = nil
    DB.transaction do
      # sace search
      s = Leads::FlSearch.new({'saved' => true, 'id_user' => @login.user.id, 'name' => name,
                               'description' => description,
                               'no_of_results' => total_rows.to_i, 'no_of_companies' => nil,
                               'positions' => [{"value" => position, "positive" => true}],
                               'locations' => [{"value" => location, "positive" => true}],
                               'industries' => [{"name" => industry, "positive" => true}] })
      s.save
    end # transaction
  rescue => e
    # libero recursos
    DB.disconnect
    GC.start
    # return errors
    redirect "#{redirect_on_error}?err="+ CGI::escape(e.message)

  end

  redirect "#{redirect_on_success}?msg=Search+Saved+Successfully"
%>