<%
  login = BlackStack::Login.where(:id=>params['login_id']).first
  if login == nil
    # libero recursos
    DB.disconnect
    GC.start
    redirect_adapted_to_nginx getDivisionURL + '/freeleads/tripwire?err='+ERR_MESSAGE_NOT_USER_LOGED_IN.to_s
  end

  user = BlackStack::User.where(:id=>login.id_user).first

  client = user.client

  (1..5).each do |i|
    name = params["n#{i}"]
    email = params["email#{i}"]
    free_lead_invite = FreeLeads::Invite.new
    free_lead_invite.id = guid().to_i
    free_lead_invite.creation_time = now()
    free_lead_invite.id_user = user.id
    free_lead_invite.first_name = name
    free_lead_invite.last_name = name
    free_lead_invite.email = email
    free_lead_invite.save
  end


# add credits in the financial statement
client.bonus(PRODUCT_FLD, now(), -27)

# force the update of the client balance snapshot
client.update_stat_balance

# redireccionar al dashboard
redirect_adapted_to_nginx getDivisionURL + '/freeleads/search'


#Todo
#Process invites by iterating fl_invites
%>